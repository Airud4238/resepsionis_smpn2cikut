<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Terpadu | SMPN 2 Cikut</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0f172a; background-size: cover; background-position: center; background-attachment: fixed; transition: background 0.5s ease; }
        .glass-panel { background: rgba(255, 255, 255, 0.92); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .sidebar-dark { background: rgba(15, 23, 42, 0.98); backdrop-filter: blur(10px); }
        #login-overlay { position: fixed; inset: 0; background: #0f172a; z-index: 10001; display: flex; align-items: center; justify-content: center; background-image: radial-gradient(circle at top right, #1e293b, #0f172a); }
        #screensaver { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; flex-direction: column; align-items: center; justify-content: center; }
        .announcement-bar { position: fixed; bottom: 0; left: 288px; right: 0; background: #fbbf24; padding: 12px; z-index: 40; border-top: 2px solid #d97706; overflow: hidden; }
        .marquee { display: inline-block; white-space: nowrap; animation: marquee 25s linear infinite; font-weight: 800; color: #1e293b; }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
    </style>
</head>
<body id="app-body" class="flex h-screen overflow-hidden text-slate-800">

    <div id="login-overlay">
        <div class="bg-white p-10 rounded-[3rem] w-full max-w-md text-center shadow-2xl">
            <div class="w-20 h-20 bg-amber-100 mx-auto rounded-3xl flex items-center justify-center mb-6">
                <i class="fa-solid fa-graduation-cap text-3xl text-amber-600"></i>
            </div>
            <h2 class="text-2xl font-black text-slate-900 mb-2">Portal SMPN 2 Cikut</h2>
            <p class="text-slate-400 text-sm mb-8 font-medium">Silakan login untuk akses data</p>
            
            <div id="g_id_onload"
                 data-client_id="MASUKKAN_CLIENT_ID_GOOGLE_ANDA_DISINI"
                 data-callback="handleCredentialResponse">
            </div>
            <div class="g_id_signin mb-6" data-type="standard"></div>

            <div class="relative flex py-5 items-center">
                <div class="flex-grow border-t border-slate-200"></div>
                <span class="flex-shrink mx-4 text-slate-400 text-xs font-bold uppercase">Atau Manual</span>
                <div class="flex-grow border-t border-slate-200"></div>
            </div>

            <div class="space-y-3">
                <input type="text" id="user-in" placeholder="Username" class="w-full p-4 rounded-2xl border border-slate-100 bg-slate-50 outline-none focus:ring-2 focus:ring-amber-500">
                <input type="password" id="pass-in" placeholder="Password" class="w-full p-4 rounded-2xl border border-slate-100 bg-slate-50 outline-none focus:ring-2 focus:ring-amber-500">
                <button onclick="attemptLogin()" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-black hover:bg-black transition shadow-xl">MASUK</button>
            </div>
            <p id="err-msg" class="text-red-500 text-xs mt-4 font-bold hidden">Akses Ditolak! Periksa kembali.</p>
        </div>
    </div>

    <div id="screensaver">
        <div id="ss-time" class="text-white text-8xl font-bold opacity-50">00:00:00</div>
        <div id="ss-logo-box" class="absolute p-6 bg-white/10 rounded-3xl border border-white/20 backdrop-blur-md text-center">
            <i class="fa-solid fa-school text-amber-400 text-5xl mb-2"></i>
            <div class="text-white font-bold text-sm uppercase tracking-widest">SMPN 2 Cikut</div>
        </div>
    </div>

    <aside class="w-72 sidebar-dark text-white flex flex-col shadow-2xl z-50">
        <div class="p-8 border-b border-slate-800/50 text-center">
            <div id="logo-frame" class="w-24 h-24 bg-white/10 mx-auto rounded-[2rem] flex items-center justify-center border border-white/20 overflow-hidden mb-4 shadow-xl">
                <i class="fa-solid fa-school text-4xl text-amber-400"></i>
            </div>
            <h1 id="name-frame" class="font-bold text-lg leading-tight uppercase tracking-tight">SMPN 2 CIKUT</h1>
        </div>
        
        <nav class="flex-1 p-4 space-y-1 mt-4">
            <button onclick="setTab('kunjungan')" class="w-full flex items-center gap-4 p-4 rounded-2xl hover:bg-white/5 transition-all text-slate-400 hover:text-white font-semibold"><i class="fa-solid fa-users"></i> Kunjungan</button>
            <button onclick="setTab('surat')" class="w-full flex items-center gap-4 p-4 rounded-2xl hover:bg-white/5 transition-all text-slate-400 hover:text-white font-semibold"><i class="fa-solid fa-envelope"></i> Surat Masuk</button>
            <button onclick="setTab('guru')" class="w-full flex items-center gap-4 p-4 rounded-2xl hover:bg-white/5 transition-all text-slate-400 hover:text-white font-semibold"><i class="fa-solid fa-chalkboard-user"></i> Izin Guru</button>
            <button onclick="setTab('siswa')" class="w-full flex items-center gap-4 p-4 rounded-2xl hover:bg-white/5 transition-all text-slate-400 hover:text-white font-semibold"><i class="fa-solid fa-graduation-cap"></i> Izin Siswa</button>
            
            <div class="pt-6 mt-6 border-t border-slate-800/50 space-y-2">
                <button onclick="setTab('setting')" class="w-full flex items-center gap-4 p-4 rounded-2xl bg-indigo-600 text-white font-bold shadow-lg"><i class="fa-solid fa-gear"></i> Pengaturan</button>
                <button onclick="doLogout()" class="w-full flex items-center gap-4 p-4 rounded-2xl text-red-400 hover:bg-red-500/10 font-bold"><i class="fa-solid fa-power-off"></i> Logout</button>
            </div>
        </nav>
    </aside>

    <main class="flex-1 flex flex-col min-w-0 pb-16">
        <header class="h-24 flex justify-between items-center px-10">
            <h2 id="header-title" class="text-white text-2xl font-black uppercase tracking-widest drop-shadow-xl">Dashboard</h2>
            <div class="flex gap-4">
                <button onclick="downloadCSV()" class="px-6 py-3 bg-white/10 text-white rounded-2xl border border-white/20 font-bold hover:bg-white/20 transition backdrop-blur-md">Download CSV</button>
                <button onclick="openForm()" class="px-6 py-3 bg-amber-500 text-slate-900 rounded-2xl font-black hover:bg-amber-400 shadow-xl transition-all scale-100 active:scale-95">TAMBAH DATA</button>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto px-10">
            <div id="table-card" class="glass-panel rounded-[2.5rem] overflow-hidden shadow-2xl">
                <table class="w-full text-left">
                    <thead id="tbl-header" class="bg-slate-900/5 text-slate-500 text-[11px] font-black uppercase tracking-tighter"></thead>
                    <tbody id="tbl-body" class="divide-y divide-slate-100 text-sm font-medium"></tbody>
                </table>
            </div>

            <div id="setting-card" class="hidden max-w-2xl mx-auto space-y-6">
                <div class="glass-panel p-10 rounded-[3rem] shadow-2xl">
                    <h3 class="text-xl font-black mb-8 border-l-8 border-amber-500 pl-4">Pengaturan Branding</h3>
                    <div class="space-y-6">
                        <div class="grid grid-cols-2 gap-6">
                            <div><label class="block text-[10px] font-black text-slate-400 uppercase mb-2">Logo</label><input type="file" onchange="uploadMedia(this, 'logo')" class="text-xs"></div>
                            <div><label class="block text-[10px] font-black text-slate-400 uppercase mb-2">Bg</label><input type="file" onchange="uploadMedia(this, 'bg')" class="text-xs"></div>
                        </div>
                        <input type="text" id="set-name" class="w-full p-4 rounded-2xl border bg-white/50 outline-none" placeholder="Nama Sekolah">
                        <textarea id="set-ann" class="w-full p-4 rounded-2xl border bg-white/50 outline-none h-32" placeholder="Teks Pengumuman"></textarea>
                        <button onclick="saveBranding()" class="w-full py-5 bg-slate-900 text-white rounded-2xl font-black">SIMPAN PERMANEN</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="announcement-bar shadow-2xl"><div class="marquee" id="ann-text">Selamat Datang di Portal SMPN 2 Cikut.</div></div>

    <div id="modal-form" class="fixed inset-0 bg-slate-950/70 backdrop-blur-md hidden flex items-center justify-center z-[100] p-6">
        <div class="bg-white w-full max-w-lg rounded-[3rem] p-12 shadow-2xl text-center">
            <h3 class="text-3xl font-black text-slate-900 mb-8">Tambah Data</h3>
            <div id="form-fields" class="space-y-5 text-left"></div>
            <div class="mt-10 flex gap-4"><button onclick="closeForm()" class="flex-1 py-4 bg-slate-100 font-bold rounded-2xl">Batal</button><button onclick="submitData()" class="flex-1 py-4 bg-amber-500 text-slate-900 font-black rounded-2xl">Simpan</button></div>
        </div>
    </div>

    <script>
        const AUTH = { user: "admin", pass: "admin123" };
        let activeTab = 'kunjungan';
        let idleSecs = 0;
        const layout = {
            kunjungan: { title: "Daftar Tamu", cols: ["Tanggal", "Nama", "Tujuan", "File"] },
            surat: { title: "Surat Masuk", cols: ["No Surat", "Instansi", "Perihal", "Scan"] },
            guru: { title: "Izin Guru", cols: ["Nama Guru", "Alasan", "Lama", "Lampiran"] },
            siswa: { title: "Izin Siswa", cols: ["Nama Siswa", "Kelas", "Alasan", "Waktu"] }
        };

        let dataStore = JSON.parse(localStorage.getItem('cikut_db')) || { kunjungan: [], surat: [], guru: [], siswa: [] };
        let settings = JSON.parse(localStorage.getItem('cikut_config')) || { name: "SMPN 2 CIKUT", ann: "Halo Admin!", logo: null, bg: null };

        // GOOGLE LOGIN HANDLER
        function handleCredentialResponse(response) {
            console.log("Encoded JWT ID token: " + response.credential);
            // Secara teknis di sini Anda memverifikasi token. 
            // Untuk demo ini, kita langsung izinkan masuk.
            document.getElementById('login-overlay').style.display = 'none';
            sessionStorage.setItem('auth_ok', 'true');
        }

        function attemptLogin() {
            const u = document.getElementById('user-in').value;
            const p = document.getElementById('pass-in').value;
            if(u === AUTH.user && p === AUTH.pass) {
                document.getElementById('login-overlay').style.display = 'none';
                sessionStorage.setItem('auth_ok', 'true');
            } else {
                document.getElementById('err-msg').classList.remove('hidden');
            }
        }

        function doLogout() { sessionStorage.removeItem('auth_ok'); location.reload(); }

        function setTab(tab) {
            activeTab = tab;
            if(tab === 'setting') {
                document.getElementById('table-card').classList.add('hidden');
                document.getElementById('setting-card').classList.remove('hidden');
                document.getElementById('set-name').value = settings.name;
                document.getElementById('set-ann').value = settings.ann;
            } else {
                document.getElementById('table-card').classList.remove('hidden');
                document.getElementById('setting-card').classList.add('hidden');
                document.getElementById('header-title').innerText = layout[tab].title;
                renderTable();
            }
        }

        function renderTable() {
            const h = document.getElementById('tbl-header');
            const b = document.getElementById('tbl-body');
            h.innerHTML = `<tr>${layout[activeTab].cols.map(c => `<th class="px-8 py-6">${c}</th>`).join('')}<th class="px-8 py-6 text-center">Aksi</th></tr>`;
            b.innerHTML = dataStore[activeTab].map((row, i) => `
                <tr class="hover:bg-white/50 transition-all">
                    ${row.map((cell, j) => `<td class="px-8 py-6 cursor-pointer" onclick="editRow(${i},${j})">${cell}</td>`).join('')}
                    <td class="px-8 py-6 text-center text-red-500"><button onclick="deleteRow(${i})"><i class="fa-solid fa-trash-can"></i></button></td>
                </tr>`).join('');
        }

        function saveBranding() {
            settings.name = document.getElementById('set-name').value;
            settings.ann = document.getElementById('set-ann').value;
            localStorage.setItem('cikut_config', JSON.stringify(settings));
            location.reload();
        }

        function uploadMedia(input, mode) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    if(mode === 'logo') settings.logo = e.target.result;
                    else settings.bg = e.target.result;
                    localStorage.setItem('cikut_config', JSON.stringify(settings));
                    location.reload();
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function editRow(r, c) {
            const val = prompt("Edit:", dataStore[activeTab][r][c]);
            if(val) { dataStore[activeTab][r][c] = val; renderTable(); localStorage.setItem('cikut_db', JSON.stringify(dataStore)); }
        }

        function deleteRow(idx) {
            if(confirm("Hapus?")) { dataStore[activeTab].splice(idx, 1); renderTable(); localStorage.setItem('cikut_db', JSON.stringify(dataStore)); }
        }

        function openForm() {
            const f = document.getElementById('form-fields');
            f.innerHTML = layout[activeTab].cols.map((col, i) => `<div><label class="text-[10px] font-black text-slate-400 uppercase">${col}</label><input type="text" id="in-${i}" class="w-full p-4 rounded-2xl border bg-slate-50 outline-none"></div>`).join('');
            document.getElementById('modal-form').classList.remove('hidden');
        }

        function closeForm() { document.getElementById('modal-form').classList.add('hidden'); }

        function submitData() {
            let row = layout[activeTab].cols.map((_, i) => document.getElementById(`in-${i}`).value);
            dataStore[activeTab].push(row);
            localStorage.setItem('cikut_db', JSON.stringify(dataStore));
            closeForm(); renderTable();
        }

        function downloadCSV() {
            let csv = layout[activeTab].cols.join(",") + "\n" + dataStore[activeTab].map(r => r.join(",")).join("\n");
            const a = document.createElement("a");
            a.href = URL.createObjectURL(new Blob([csv], { type: 'text/csv' }));
            a.download = `Data_SMPN2.csv`;
            a.click();
        }

        // SCREENSAVER BOUNCE
        let sx=0, sy=0, sdx=2, sdy=2;
        function bounce() {
            const b = document.getElementById('ss-logo-box');
            if (document.getElementById('screensaver').style.display === 'flex') {
                sx += sdx; sy += sdy;
                if (sx + 200 > window.innerWidth || sx < 0) sdx = -sdx;
                if (sy + 150 > window.innerHeight || sy < 0) sdy = -sdy;
                b.style.left = sx + 'px'; b.style.top = sy + 'px';
                requestAnimationFrame(bounce);
            }
        }

        window.onload = () => {
            if(sessionStorage.getItem('auth_ok') === 'true') document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('name-frame').innerText = settings.name;
            document.getElementById('ann-text').innerText = settings.ann;
            if(settings.logo) document.getElementById('logo-frame').innerHTML = `<img src="${settings.logo}" class="w-full h-full object-cover">`;
            if(settings.bg) document.getElementById('app-body').style.backgroundImage = `url('${settings.bg}')`;
            renderTable();
            
            document.onmousemove = () => { idleSecs = 0; document.getElementById('screensaver').style.display = 'none'; };
            setInterval(() => {
                document.getElementById('ss-time').innerText = new Date().toLocaleTimeString();
                if (++idleSecs >= 30 && sessionStorage.getItem('auth_ok') === 'true') {
                    document.getElementById('screensaver').style.display = 'flex'; bounce();
                }
            }, 1000);
        };
    </script>
</body>
</html>